<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Alterar Cliente</title>
    <script>
        function limpa_formulario() {
            //Limpa valores do formulário.
            document.getElementById('nome').value = ("");
            document.getElementById('endereco').value = ("");
            document.getElementById('cep').value = ("");
            document.getElementById('pais').value = ("");
            document.getElementById('cpf').value = ("");
            document.getElementById('passaporte').value = ("");
            document.getElementById('email').value = ("");
            document.getElementById('nasc').value = ("");
        }

        function CepValido(vPonto) {
            let validacep = /^[0-9]{8}$/;
            return validacep.test(vPonto);
        }

        function TestaCPF(strCPF) {
            var Soma;
            var Resto;
            Soma = 0;
            if (strCPF == "00000000000") return false;

            for (i = 1; i <= 9; i++) Soma = Soma + parseInt(strCPF.substring(i - 1, i)) * (11 - i);
            Resto = (Soma * 10) % 11;

            if ((Resto == 10) || (Resto == 11)) Resto = 0;
            if (Resto != parseInt(strCPF.substring(9, 10))) return false;

            Soma = 0;
            for (i = 1; i <= 10; i++) Soma = Soma + parseInt(strCPF.substring(i - 1, i)) * (12 - i);
            Resto = (Soma * 10) % 11;

            if ((Resto == 10) || (Resto == 11)) Resto = 0;
            if (Resto != parseInt(strCPF.substring(10, 11))) return false;
            return true;
        }

        function validardataDeNascimento(data) {
            dataAtual = new Date();
            data = new Date(data);

            if (data < dataAtual) {
                console.log("Data Válida");
                return true;
            } else {
                console.log("Data Inválida");
                return false;
            }
        }

        function FormValido(pNome, pEndereco, pPais, pCep, pCpf, pNascimento) {
            let msg = "";
            if (pNome == "") {
                msg = "Nome não pode ser vazio. <br>";
            }
            if (pEndereco == "") {
                msg += "Endereço não pode ser vazio. <br>";
            }
            if (pPais == "") {
                msg += "País não pode ser vazio. <br>";
            }
            if (!CepValido(pCep)) {
                msg += "Cep inválido. <br>";
                limpa_formulario();
            }
            if (TestaCPF(pCpf) == false) {
                msg += "Cpf inválido. <br>";
                limpa_formulario();
            }
            if (validardataDeNascimento(pNascimento) == false) {
                msg += "Data de nascimento inválida. <br>";
                limpa_formulario();
            }

            /*Realizar as demais validações*/

            return msg;
        }
        function ValidarForm() {
            let objForm = document.getElementById("alteraCliente");
            console.log("objForm: " + objForm.innerHTML);
            let strId = document.getElementById("id").value;
            let strNome = document.getElementById("nome").value;
            let strEndereco = document.getElementById("endereco").value;
            let strCep = document.getElementById("cep").value;
            let strPais = document.getElementById("pais").value;
            let strCpf = document.getElementById("cpf").value;
            let strPassaporte = document.getElementById("passaporte").value;
            let strEmail = document.getElementById("email").value;
            let strNascimento = document.getElementById("nasc").value;
            console.log("Nome Cliente: " + strNome + " Endereço: " + strEndereco + " Cep: " + strCep + " País: " + strPais
                + " Cpf: " + strCpf + " Passaporte: " + strPassaporte + " Email: " + strEmail + " Data Nascimento: " +
                strNascimento);
            let mensagem = FormValido(strNome, strEndereco, strPais, strCep, strCpf, strNascimento);

            let objJSON = JSON.stringify(objForm);
            console.log("JSON: " + objJSON);

            if (mensagem == "") {
                console.log("Passou na validação");
                EnviarForm(strId, strNome, strEndereco, strPais, strCep, strCpf, strPassaporte, strEmail, strNascimento);
            } else {
                document.getElementById("msg").innerHTML = mensagem;
            }
        }
        function EnviarForm(eId, eNome, eEndereco, ePais, eCep, eCpf, ePassaporte, eEmail, eNascimento) {
            let xmlHttp = new XMLHttpRequest();
            xmlHttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    console.log("Chegou resposta: " + this.responseText);
                    document.getElementById("msg").innerHTML = this.responseText;
                    let objReturnJSON = JSON.parse(this.responseText);
                }
            }
            xmlHttp.open("GET", "http://localhost/RepositorioPHP/ProvaAv2/AlterarCliente.php?id=" + eId + "&nome=" + eNome +
                "&endereco=" + eEndereco + "&pais=" + ePais + "&cep=" + eCep + "&cpf=" + eCpf +
                "&passaporte=" + ePassaporte + "&email=" + eEmail + "&nasc=" + eNascimento);
            xmlHttp.send();
            console.log("Enviei requisição");
        }
    </script>
</head>

<body>
    <h1>Alterar Cliente</h1>
    <br>
    <a href="IncluirCliente.html">Inserir Cliente</a><br>
    <a href="AlterarCliente.html">Alterar Cliente</a><br>
    <a href="ListarClientes.html">Listar Cliente</a><br>
    <br>
    <form action="" method=GET id="alteraCliente">
        Id do Cliente: <input type=number name="id" id="id"> <br>
        Nome do Cliente: <input type=text name="nome" id="nome"> <br>
        Endereço do Cliente: <input type=text name="endereco" id="endereco"> <br>
        Cep do Cliente: <input type=text name="cep" id="cep"> <br>
        País do Cliente: <input type=text name="pais" id="pais"> <br>
        Cpf do Cliente: <input type=text name="cpf" id="cpf"> <br>
        Passaporte do Cliente: <input type=text name="passaporte" id="passaporte"> <br>
        Email do Cliente: <input type=mail name="email" id="email"> <br>
        Data de Nascimento do cliente: <input type=date name="nasc" id="nasc"> <br>
        <!--Incluir validação de Data via JS-->
        <br><br>
        <input type="button" value="Alterar" onclick="ValidarForm()">
    </form>
    <br>
    <p id="msg"></p>
</body>

</html>